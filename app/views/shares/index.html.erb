<div class="page-header">
  <% if current_user.editor? %>
    <%= link_to new_company_share_path, :class => 'btn btn-primary float-right' do %>
      <span class="fa fa-plus"></span>
      New Share
    <% end %>
  <% end %>
  <%= link_to dashboard_company_shares_path, :class => 'btn btn-primary float-right' do %>
    <span class="fa fa-tachometer-alt"></span>
    Dashboard
  <% end %>

  <h2>Shares</h2>

  <div style="float:right">

    <%= form_tag({:controller => "shares", :action => "index"}, :method => "get")  do %>
      <%= select_tag "filter", options_for_select(Stockplan.where(company_id: @company.id).all.map{ |i|[i.series, i.id] }.insert(0, "All"), params[:filter]), {:onchange => 'this.form.submit()'}  %>
    <% end %>
  </div>
</div>

<div class="table-responsive-lg">
  <table role='datatable' id="sharesTable" class="table table-striped table-bordered table-hover table-sm dataTable">
    <thead>
    <tr>
      <th>Certificate</th>
      <th>Shareholder</th>
      <th>Series</th>
      <th>Restricted</th>
      <th>Shares issued</th>
      <th>Share price</th>
      <th>Cash</th>
      <th>Issued date</th>
      <th>Active </th>
      <th>Notes</th>
      <th>Status</th>
      <th>View</th>
    </tr>
    </thead>

    <tbody>
    <% @shares.each do |share| %>
    <tr>
      <td><%= share.certificate %></td>
      <td><%= link_to company_person_path(@company, share.person_id) do %><%= share.person.name %><%end%></td>
      <td><%= link_to company_stockplan_path(@company, share.stockplan_id) do %><%= share.stockplan.series %><%end%></td>
      <td align="center">
        <% if share.restricted  %>
          <span class="fa fa-check-circle" style="color:orange"></span>
        <% else %>
          <span class="fa fa-ban"></span>
        <% end %>
      </td>
      <td><%= number_with_delimiter(share.shares_issued, :delimiter => ',') %></td>
      <td align="right"><%= number_to_currency(share.share_price, precision: 4) %></td>
      <td align="right"><%= number_to_currency(share.cash, precision: 2) %></td>
      <td><%= share.issued_date %></td>
      <% if share.active  %>
        <td align="center"><span class="fa fa-check-circle" style="color:green"></span></td>
      <% else %>
        <td align="center">
          <span class="fa fa-ban" style="color:red"></span>
        </td>
      <% end %>
      <td><%= share.notes %></td>
      <td><%= share.status %></td>
      <% if share.share_document.attached?  %>
        <td align="center"><%= link_to image_pack_tag("pdf_icon.png"), company_share_path(@company, share) %></td>
      <% else %>
        <td align="center">
          <%= link_to company_share_path(@company, share) do %>
            <span class="fa fa-ban"></span>
          <% end %>
        </td>
      <% end %>
    </tr>
    <% end %>
    </tbody>
  </table>
</div>

<div class="page-header">
  <% if current_user.editor? %>
    <%= link_to new_company_share_path, :class => 'btn btn-primary float-right' do %>
      <span class="fa fa-plus"></span>
      New Share
    <% end %>
  <% end %>
</div>
